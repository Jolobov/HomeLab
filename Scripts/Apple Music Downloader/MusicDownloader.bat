@echo off
REM --- Устанавливаем кодировку для правильного отображения кириллицы
chcp 65001 > nul

REM --- Определяем основную папку для музыки в переменную для удобства
set "MUSIC_FOLDER=%USERPROFILE%\Music\Apple Music\Download"
set "CONFIG_FILE=%~dp0config.json"

REM --- Проверка 1: Существует ли файл конфигурации?
if not exist "%CONFIG_FILE%" (
    cls
    echo =================================================================
    echo  ОШИБКА: Файл конфигурации не найден!
    echo =================================================================
    echo.
    echo Скрипт не может найти файл "config.json" в своей папке.
    echo Пожалуйста, убедитесь, что он находится здесь:
    echo %~dp0
    echo.
    pause
    exit /b
)

REM --- Проверка 2: Существует ли папка назначения? Если нет, создаем ее.
if not exist "%MUSIC_FOLDER%" (
    echo Создание папки назначения: %MUSIC_FOLDER%
    md "%MUSIC_FOLDER%"
)


cls
echo =================================================================
echo  DOWNLOADING TRACKS
echo =================================================================
echo.
echo Destination: %MUSIC_FOLDER%
echo Config file: %CONFIG_FILE%
echo.

REM --- Запускаем gamdl, передавая ему пути для музыки и временных файлов
gamdl --config-path "%CONFIG_FILE%" --output-path "%MUSIC_FOLDER%" --temp-path "%MUSIC_FOLDER%\temp" %*

REM --- Проверка 3: Проверяем, успешно ли завершился gamdl
if errorlevel 1 (
    echo.
    echo =================================================================
    echo  ВНИМАНИЕ: Процесс завершился с ошибками.
    echo =================================================================
    echo.
    echo Проверьте сообщения об ошибках выше.
    echo Возможно, проблема со ссылкой, cookies или подключением к сети.
) else (
    echo.
    echo =================================================================
    echo  ВСЕ ЗАДАЧИ УСПЕШНО ВЫПОЛНЕНЫ.
    echo =================================================================
    echo.
    echo Вы можете найти вашу музыку в: "%MUSIC_FOLDER%"
)

echo.
pause